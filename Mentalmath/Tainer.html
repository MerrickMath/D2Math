<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Mental Math Trainer</title>

  <!-- KaTeX -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css">
  <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/computer-modern@0.1.2/index.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"></script>

  <style>
    :root { --accent:#1f6feb; }
    html, body { background:#fff; color:#111; }
    /* LaTeX-style body text everywhere (buttons/inputs inherit) */
    body {
      font-family: "Computer Modern Serif", "Latin Modern Roman",
                   "Times New Roman", Times, serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* ensure UI bits also use the LaTeX font */
    button, input, .label, .hint { font-family: inherit; }
    
    /* (optional) nice, even numerals for timers/sums */
    body { font-variant-numeric: lining-nums tabular-nums; }

    .bar { display:flex; flex-direction:column; gap:.5rem; margin-bottom:1rem; }
    .bar h1 { font-size:1.6rem; margin:0; letter-spacing:.25px; }
    .controls { display:flex; gap:.5rem; align-items:center; flex-wrap:wrap; }
    .btn { border:1px solid #d0d7de; background:#fff; border-radius:10px; padding:.6rem .9rem; cursor:pointer; font-weight:600; }
    .btn:hover { border-color:#111; box-shadow:0 1px 4px rgba(0,0,0,.08); }
    .seed { display:flex; align-items:center; gap:.35rem; }
    .seed input { width: 14ch; padding:.45rem .55rem; border:1px solid #d0d7de; border-radius:8px; font:inherit; }

    .hint { color:#555; font-size:.9rem; }

    .grid { display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: .9rem; }
    @media (max-width: 640px){ .grid { grid-template-columns: 1fr; } }

    /* Big tappable question cards */
    .qbtn { 
      display:flex; flex-direction:column; justify-content:center; align-items:center;
      min-height: 140px; padding: 1.1rem; border:2px solid #d0d7de; border-radius:16px; background:#fff; cursor:pointer;
      font-size: 1.35rem; text-align:center; line-height:1.35;
      transition: box-shadow .15s ease, border-color .15s ease, transform .02s ease-in-out;
      user-select:none;
    }
    .qbtn:hover { border-color:#111; box-shadow:0 2px 10px rgba(0,0,0,.08); }
    .qbtn:active { transform: scale(.995); }

    .label { font-size:.85rem; font-weight:700; letter-spacing:.02em; color:#555; margin-bottom:.25rem; text-transform:uppercase; }

    /* KaTeX sizing tweaks inside big buttons */
    .qbtn .katex { font-size:1.05em; }

    .footer { margin-top:1rem; display:flex; gap:.6rem; align-items:center; flex-wrap:wrap; }
    .spacer { flex:1; }
  </style>
</head>
<body>
  <div class="bar">
    <h1>Mental Math Trainer</h1>
    <div class="controls">
      <span class="seed">Seed <input id="seed" type="number" placeholder="random"></span>
      <button class="btn" id="newSet">New set of 4</button>
      <button class="btn" id="showAll">Show all answers</button>
      <button class="btn" id="hideAll">Hide all answers</button>
      <span class="hint">Click any card to reveal its answer.</span>
    </div>
  </div>

  <div id="cards" class="grid"></div>

  <div class="footer">
    <span class="hint">Includes sums, differences (incl. rounded), products/quotients, fractions, percents, and integer ops.</span>
    <span class="spacer"></span>
  </div>

  <script>
    // ---------- Random helpers ----------
    function mulberry32(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return((t^t>>>14)>>>0)/4294967296;}}
    function randi(rng, lo, hi){return Math.floor(rng()*(hi-lo+1))+lo;}
    function choice(rng,a){return a[Math.floor(rng()*a.length)];}
    function shuffleInPlace(rng, arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(rng()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;}
    function round2(x){return Math.round(x*100)/100;}

    // ---------- Fraction helpers ----------
    function gcd(a,b){a=Math.abs(a);b=Math.abs(b);while(b){[a,b]=[b,a%b]}return a;}
    function reduceFrac(n,d){const g=gcd(n,d);return[n/g,d/g];}
    function fracTex(n,d){return `\\dfrac{${n}}{${d}}`;}

    // ---------- Generators return {q, a} where q/a may contain TeX ----------
    function genDecAddRound(rng){
      const a=(randi(rng,100,999)/100).toFixed(2), b=(randi(rng,100,999)/100).toFixed(2), c=(randi(rng,100,999)/100).toFixed(2);
      const sum = parseFloat(a)+parseFloat(b)+parseFloat(c);
      return { q:`Calculate $${a}+${b}+${c}$ rounded to the nearest tenth.`, a:`${(Math.round(sum*10)/10).toFixed(1)}` };
    }
    function genDecSubRound(rng){
      let a=randi(rng,1000,9999)/100, b=randi(rng,1000,9999)/100; if(a<b)[a,b]=[b,a];
      const diff=a-b; return { q:`Calculate $${a.toFixed(2)} - ${b.toFixed(2)}$ rounded to the nearest hundredth.`, a:`${(Math.round(diff*100)/100).toFixed(2)}` };
    }
    function genSmallMinusBig(rng){
      const s=randi(rng,10,99), b=randi(rng,100,999); return { q:`What is $${s}-${b}$?`, a:`${s-b}` };
    }
    function genPercentOf(rng){ const pct=choice(rng,[5,10,15,20,25,30,40,50,60,70,75,80,90]), base=randi(rng,20,150); return { q:`What is $${pct}\\%$ of $${base}$?`, a:`${round2((pct/100)*base)}` } }
    function genFracAdd(rng){
      const d1=randi(rng,2,12), n1=randi(rng,1,d1-1), d2=randi(rng,2,12), n2=randi(rng,1,d2-1);
      let N=n1*d2+n2*d1, D=d1*d2; [N,D]=reduceFrac(N,D);
      const ans = D===1?`${N}`:`\\dfrac{${N}}{${D}}`;
      return { q:`What is $${fracTex(n1,d1)} + ${fracTex(n2,d2)}$?`, a:`$${ans}$` };
    }
    function genIntegerDivision(rng){ const d=randi(rng,2,21), q=randi(rng,6,99); return { q:`What is $${d*q}\\div${d}$?`, a:`${q}` } }
    function genMulSmall(rng){ const a=randi(rng,11,99), b=randi(rng,11,99); return { q:`What is $${a}\\times${b}$?`, a:`${a*b}` } }
    function genDivClean(rng){ let a=randi(rng,111,999), b=randi(rng,3,9); while(a%b!==0){a=randi(rng,111,999); b=randi(rng,3,9);} return { q:`What is $${a}\\div${b}$?`, a:`${a/b}` } }
    function genSubtractNegative(rng){ const p=randi(rng,5,70), q=randi(rng,5,70); return { q:`What is $${p} - (-${q})$?`, a:`${p+q}` } }
    function genDecSub(rng){ const a=randi(rng,800,3000), b=randi(rng,100,a); return { q:`What is $${(a/100).toFixed(2)} - ${(b/100).toFixed(2)}$?`, a:`${((a-b)/100).toFixed(2)}` } }

    const GEN_FUNS = [
      genDecAddRound, genDecSubRound, genSmallMinusBig, genPercentOf, genFracAdd,
      genIntegerDivision, genMulSmall, genDivClean, genSubtractNegative, genDecSub
    ];

    // ---------- Rendering ----------
    const cardsEl = document.getElementById('cards');
    const newSetBtn = document.getElementById('newSet');
    const showAllBtn = document.getElementById('showAll');
    const hideAllBtn = document.getElementById('hideAll');

    function renderMath(scope=document.body){
      window.renderMathInElement(scope, {
        delimiters: [ {left:'$$', right:'$$', display:true}, {left:'$', right:'$', display:false} ],
        throwOnError: false
      });
    }

    function makeCardHTML(qText, aText){
      return `<div class="label">Question</div><div class="content">${qText}</div>`;
    }

    function setCardToQuestion(btn, qText){
      btn.dataset.state='q';
      btn.innerHTML = `<div class="label">Question</div><div class="content">${qText}</div>`;
      renderMath(btn);
    }
    function setCardToAnswer(btn, aText){
      btn.dataset.state='a';
      const ans = (typeof aText==="string" && aText.trim().startsWith('$'))? aText : `$${aText}$`;
      btn.innerHTML = `<div class="label">Answer</div><div class="content">${ans}</div>`;
      renderMath(btn);
    }

    function generate(){
      const seedInput = document.getElementById('seed').value;
      const seed = seedInput ? Number(seedInput) : Math.floor(Math.random()*1e9);
      const rng = mulberry32(seed);

      // Pick 4 distinct generators
      const picked = shuffleInPlace(rng, GEN_FUNS.slice()).slice(0,4);
      const qas = picked.map(fn => fn(rng));

      // Build cards
      cardsEl.innerHTML = '';
      qas.forEach(({q,a}, idx) => {
        const btn = document.createElement('button');
        btn.className = 'qbtn';
        btn.type = 'button';
        btn.dataset.idx = idx;
        btn.dataset.q = q;
        btn.dataset.a = a;
        setCardToQuestion(btn, q);
        btn.addEventListener('click', () => {
          if (btn.dataset.state==='q') setCardToAnswer(btn, a); else setCardToQuestion(btn, q);
        });
        cardsEl.appendChild(btn);
      });
    }

    // Controls
    newSetBtn.addEventListener('click', generate);
    showAllBtn.addEventListener('click', () => {
      [...cardsEl.querySelectorAll('.qbtn')].forEach(btn => setCardToAnswer(btn, btn.dataset.a));
    });
    hideAllBtn.addEventListener('click', () => {
      [...cardsEl.querySelectorAll('.qbtn')].forEach(btn => setCardToQuestion(btn, btn.dataset.q));
    });

    window.addEventListener('load', generate);
    window.addEventListener('load', () => renderMath(document.body));
  </script>
</body>
</html>
